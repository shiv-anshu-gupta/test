

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> utils/timeInterpolation.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-chartComponent.html">chartComponent</a></li><li><a href="module-chartDomUtils.html">chartDomUtils</a></li><li><a href="module-chartManager.html">chartManager</a></li><li><a href="module-comtradeUtils.html">comtradeUtils</a></li><li><a href="module-createDragBar.html">createDragBar</a></li><li><a href="module-handleVerticalLineShortcuts.html">handleVerticalLineShortcuts</a></li><li><a href="module-main.html">main</a></li><li><a href="module-renderAnalogCharts.html">renderAnalogCharts</a></li><li><a href="module-renderComtradeCharts.html">renderComtradeCharts</a></li><li><a href="module-renderDigitalCharts.html">renderDigitalCharts</a></li><li><a href="module-setupChartDragAndDrop.html">setupChartDragAndDrop</a></li><li><a href="module-showChannelListWindow.html">showChannelListWindow</a></li><li><a href="module-timeInterpolation.html">timeInterpolation</a></li></ul><h3>Global</h3><ul><li><a href="global.html#autoGroupChannels">autoGroupChannels</a></li><li><a href="global.html#createChannelList">createChannelList</a></li><li><a href="global.html#createChartContainer">createChartContainer</a></li><li><a href="global.html#createChartOptions">createChartOptions</a></li><li><a href="global.html#createDigitalFillPlugin">createDigitalFillPlugin</a></li><li><a href="global.html#createState">createState</a></li><li><a href="global.html#createTooltip">createTooltip</a></li><li><a href="global.html#hideTooltip">hideTooltip</a></li><li><a href="global.html#initUPlotChart">initUPlotChart</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#subscribeChartUpdates">subscribeChartUpdates</a></li><li><a href="global.html#updateTooltip">updateTooltip</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>utils/timeInterpolation.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file timeInterpolation.js
 * @description Time interpolation utilities for COMTRADE data with non-uniform sampling
 * @module timeInterpolation
 */

/**
 * Find the applicable sampling rate for a given sample number
 * @param {number} sampleNumber - The sample number
 * @param {Array} samplingRates - Array of sampling rate objects from CFG
 * @returns {number} The sampling rate in Hz
 */
export function findSamplingRateForSample(sampleNumber, samplingRates) {
  for (let sr of samplingRates) {
    if (sampleNumber &lt;= sr.endSample) {
      return sr.rate;
    }
  }
  // Default to last rate if sample exceeds all end samples
  return samplingRates[samplingRates.length - 1].rate;
}

/**
 * Calculate time from sample number using sampling rate
 * Creates UNIFORM time spacing regardless of DAT file timestamps
 *
 * @param {number} sampleNumber - The sample index (0, 1, 2, ...)
 * @param {Array} samplingRates - Array of { rate, endSample } objects
 * @returns {number} Time in seconds
 *
 * @example
 * // Sampling rate: 4000 Hz
 * // Result: [0, 0.00025, 0.0005, 0.00075, 0.001, ...]
 * const time = calculateTimeFromSampleNumber(0, [{ rate: 4000, endSample: 99999 }]);
 */
export function calculateTimeFromSampleNumber(sampleNumber, samplingRates) {
  const samplingRate = findSamplingRateForSample(sampleNumber, samplingRates);
  return sampleNumber / samplingRate;
}

/**
 * Linear interpolation between two points
 *
 * @param {number} x1 - First x coordinate
 * @param {number} y1 - First y value
 * @param {number} x2 - Second x coordinate
 * @param {number} y2 - Second y value
 * @param {number} x - Position where you want to interpolate
 * @returns {number} Interpolated y value
 *
 * @example
 * const result = linearInterpolate(0, 10, 4, 20, 2);
 * console.log(result); // 15
 */
export function linearInterpolate(x1, y1, x2, y2, x) {
  if (x2 === x1) return y1; // Avoid division by zero
  const slope = (y2 - y1) / (x2 - x1);
  return y1 + (x - x1) * slope;
}

/**
 * Generate uniform time array from sample numbers
 *
 * @param {number} totalSamples - Total number of samples
 * @param {Array} samplingRates - Sampling rate configuration
 * @returns {Array&lt;number>} Uniform time array in seconds
 *
 * @example
 * const times = generateUniformTimeArray(1000, [{ rate: 4000, endSample: 99999 }]);
 * // Result: [0, 0.00025, 0.0005, 0.00075, ..., 0.24975]
 */
export function generateUniformTimeArray(totalSamples, samplingRates) {
  const timeArray = [];
  for (let i = 0; i &lt; totalSamples; i++) {
    timeArray.push(calculateTimeFromSampleNumber(i, samplingRates));
  }
  return timeArray;
}

/**
 * Interpolate data values at new time points
 * Useful for resampling or filling missing values
 *
 * @param {Array&lt;number>} originalTimes - Original time array
 * @param {Array&lt;number>} originalData - Original data values
 * @param {Array&lt;number>} newTimes - New time points where to interpolate
 * @returns {Array&lt;number>} Interpolated data values
 *
 * @example
 * const original = { times: [0, 0.001, 0.002], data: [10, 15, 20] };
 * const newTimes = [0, 0.0005, 0.001, 0.0015, 0.002];
 * const interpolated = interpolateData(original.times, original.data, newTimes);
 * // Result: [10, 12.5, 15, 17.5, 20]
 */
export function interpolateData(originalTimes, originalData, newTimes) {
  const interpolatedData = [];

  for (let newTime of newTimes) {
    // Find surrounding points
    let leftIdx = -1;
    let rightIdx = -1;

    for (let i = 0; i &lt; originalTimes.length; i++) {
      if (originalTimes[i] &lt;= newTime) {
        leftIdx = i;
      }
      if (originalTimes[i] >= newTime) {
        rightIdx = i;
        break;
      }
    }

    // Handle edge cases
    if (leftIdx === -1) {
      // Before first point
      interpolatedData.push(originalData[0]);
    } else if (rightIdx === -1) {
      // After last point
      interpolatedData.push(originalData[originalData.length - 1]);
    } else if (leftIdx === rightIdx) {
      // Exact match
      interpolatedData.push(originalData[leftIdx]);
    } else {
      // Interpolate between two points
      const t1 = originalTimes[leftIdx];
      const v1 = originalData[leftIdx];
      const t2 = originalTimes[rightIdx];
      const v2 = originalData[rightIdx];

      const interpolatedValue = linearInterpolate(t1, v1, t2, v2, newTime);
      interpolatedData.push(interpolatedValue);
    }
  }

  return interpolatedData;
}

/**
 * Compare original timestamps (from DAT) with calculated timestamps
 * Useful for detecting non-uniform sampling
 *
 * @param {Array&lt;number>} fileTimestamps - Timestamps from DAT file
 * @param {Array&lt;number>} calculatedTimestamps - Calculated from sample numbers
 * @returns {Object} Comparison statistics
 *
 * @example
 * const comparison = compareTimestamps([0, 1, 2, 6, 7], [0, 0.00025, 0.0005, 0.00075, 0.001]);
 * console.log(comparison);
 * // { differences: [0, 0.99975, 1.9995, 5.99925, 6.999], hasGaps: true, maxGap: 5.99925 }
 */
export function compareTimestamps(fileTimestamps, calculatedTimestamps) {
  const differences = [];
  let maxGap = 0;
  let hasGaps = false;

  for (
    let i = 0;
    i &lt; Math.min(fileTimestamps.length, calculatedTimestamps.length);
    i++
  ) {
    const diff = Math.abs(fileTimestamps[i] - calculatedTimestamps[i]);
    differences.push(diff);

    if (diff > 0.0001) {
      // Threshold for considering it a gap
      hasGaps = true;
      maxGap = Math.max(maxGap, diff);
    }
  }

  return {
    differences,
    hasGaps,
    maxGap,
    totalDifference: differences.reduce((a, b) => a + b, 0),
  };
}

/**
 * Detect if time array has uniform spacing
 *
 * @param {Array&lt;number>} timeArray - Time values
 * @param {number} toleranceMicroSeconds - Tolerance in microseconds (default: 1)
 * @returns {Object} Uniformity analysis
 *
 * @example
 * const uniform = detectUniformSpacing([0, 0.00025, 0.0005, 0.00075]);
 * console.log(uniform);
 * // { isUniform: true, intervals: [0.00025, 0.00025, 0.00025], avgInterval: 0.00025 }
 */
export function detectUniformSpacing(timeArray, toleranceMicroSeconds = 1) {
  if (timeArray.length &lt; 2) {
    return { isUniform: true, intervals: [], avgInterval: 0 };
  }

  const intervals = [];
  for (let i = 1; i &lt; timeArray.length; i++) {
    intervals.push(timeArray[i] - timeArray[i - 1]);
  }

  const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
  const tolerance = toleranceMicroSeconds / 1e6; // Convert to seconds

  let isUniform = true;
  for (let interval of intervals) {
    if (Math.abs(interval - avgInterval) > tolerance) {
      isUniform = false;
      break;
    }
  }

  return {
    isUniform,
    intervals,
    avgInterval,
    maxDeviation: Math.max(...intervals.map((i) => Math.abs(i - avgInterval))),
  };
}

export default {
  findSamplingRateForSample,
  calculateTimeFromSampleNumber,
  linearInterpolate,
  generateUniformTimeArray,
  interpolateData,
  compareTimestamps,
  detectUniformSpacing,
};
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
