

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> components/createState copy.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-chartComponent.html">chartComponent</a></li><li><a href="module-chartDomUtils.html">chartDomUtils</a></li><li><a href="module-chartManager.html">chartManager</a></li><li><a href="module-comtradeUtils.html">comtradeUtils</a></li><li><a href="module-createDragBar.html">createDragBar</a></li><li><a href="module-handleVerticalLineShortcuts.html">handleVerticalLineShortcuts</a></li><li><a href="module-main.html">main</a></li><li><a href="module-renderAnalogCharts.html">renderAnalogCharts</a></li><li><a href="module-renderComtradeCharts.html">renderComtradeCharts</a></li><li><a href="module-renderDigitalCharts.html">renderDigitalCharts</a></li><li><a href="module-setupChartDragAndDrop.html">setupChartDragAndDrop</a></li><li><a href="module-showChannelListWindow.html">showChannelListWindow</a></li><li><a href="module-timeInterpolation.html">timeInterpolation</a></li></ul><h3>Global</h3><ul><li><a href="global.html#autoGroupChannels">autoGroupChannels</a></li><li><a href="global.html#createChannelList">createChannelList</a></li><li><a href="global.html#createChartContainer">createChartContainer</a></li><li><a href="global.html#createChartOptions">createChartOptions</a></li><li><a href="global.html#createDigitalFillPlugin">createDigitalFillPlugin</a></li><li><a href="global.html#createState">createState</a></li><li><a href="global.html#createTooltip">createTooltip</a></li><li><a href="global.html#hideTooltip">hideTooltip</a></li><li><a href="global.html#initUPlotChart">initUPlotChart</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#subscribeChartUpdates">subscribeChartUpdates</a></li><li><a href="global.html#updateTooltip">updateTooltip</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>components/createState copy.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * createState.js
 * 
 * Lightweight deep-reactive state management with flexible DOM binding.
 * 
 * Features:
 * - Deep reactivity: Nested objects and arrays are fully reactive using Proxies.
 * - State change subscriptions: Listen to all or specific property changes.
 * - Flexible DOM binding: Bind state to any DOM property (e.g. value, textContent, innerHTML) or attribute (e.g. data-*), with one-way or two-way sync.
 * - Clean API: No dependency on frameworks. Suitable for vanilla JS, widgets, and demos.
 * 
 * Best Practices:
 * - Use state for application data, and use DOM binding for presentation/UI.
 * - For forms, consider a separate UI state to avoid polluting main state while editing.
 * - Use subscription for non-DOM side-effects (e.g., analytics, logging, computed props).
 * 
 * Example Usage:
 * 
 * // ----- STATE CREATION -----
 * // Primitives or objects can be passed in
 * const state = createState({ 
 *   user: { name: "Alice", age: 30 },
 *   isDark: false,
 *   counter: 0,
 *   notes: ["first", "second"]
 * });
 * 
 * // ----- STATE GET/SET -----
 * state.counter++;            // Set primitive
 * console.log(state.counter); // Get
 * state.user.name = "Bob";    // Set nested
 * console.log(state.user.name);
 * state.notes.push("third");  // Arrays work too
 * 
 * // ----- DEEP NESTING -----
 * state.user.profile = { city: "NY", socials: { twitter: "@alice" } };
 * state.user.profile.city = "LA";
 * state.user.profile.socials.twitter = "@bob";
 * 
 * // ----- SUBSCRIBE TO CHANGES -----
 * // Listen to all changes
 * state.subscribe(change => {
 *   // change.path: array of keys (e.g. ['user','name'])
 *   // change.newValue, change.oldValue, change.prop, change.root
 *   console.log("Changed:", change.path.join("."), change.oldValue, "→", change.newValue);
 * });
 * 
 * // Unsubscribe: state.unsubscribe(fn)
 * 
 * // ----- DOM BINDING -----
 * // &lt;input id="nameInput">   &lt;span id="nameDisplay">&lt;/span>
 * // One-way: state → DOM
 * state.bindToDOM('user.name', '#nameDisplay', { prop: 'textContent' });
 * // Two-way: input ↔ state
 * state.bindToDOM('user.name', '#nameInput', { twoWay: true });
 * 
 * // Bind to attribute
 * state.bindToDOM('user.name', '#nameDisplay', { attr: 'data-username' });
 * 
 * // Bind to checkbox
 * // &lt;input id="isDark" type="checkbox">
 * state.bindToDOM('isDark', '#isDark', { twoWay: true });
 * 
 * // Bind to innerHTML
 * state.bindToDOM('notes', '#notesList', { prop: 'innerHTML' });
 * 
 * // ----- UNBINDING -----
 * // Returns an unbind function
 * const unbind = state.bindToDOM('user.name', '#nameInput', { twoWay: true });
 * unbind(); // Removes listeners
 */

export function createState(initialState) {
  const listeners = new Set();

  // Helper: returns true for non-null objects/arrays
  const isObject = (val) => val &amp;&amp; typeof val === "object";

  // --- Core: Deep reactive Proxy ---
  function createDeepProxy(target, path = []) {
    return new Proxy(target, {
      set(obj, prop, value) {
        const oldValue = obj[prop];
        // Deep-proxy new object/array values
        if (isObject(value) &amp;&amp; !value.__isReactive) {
          value = createDeepProxy(value, path.concat(prop));
        }
        obj[prop] = value;
        // Notify all listeners
        listeners.forEach(fn =>
          fn({
            path: path.concat(prop),
            newValue: value,
            oldValue,
            prop,
            root: proxy
          })
        );
        return true;
      },
      get(obj, prop) {
        if (prop === "__isReactive") return true;
        if (prop === "asArray") {
          // Return a function that returns a shallow copy of the underlying array if this is an array
          return () => Array.isArray(obj) ? Array.from(obj) : obj;
        }
        const value = obj[prop];
        // Lazy-proxy nested objects/arrays
        if (isObject(value) &amp;&amp; !value.__isReactive) {
          obj[prop] = createDeepProxy(value, path.concat(prop));
          return obj[prop];
        }
        return value;
      }
    });
  }

  // Wrap primitives in an object for consistent Proxying
  const root =
    initialState === null || typeof initialState !== "object"
      ? { value: initialState }
      : initialState;

  const proxy = createDeepProxy(root);

  // --- Subscription API ---
  /**
   * Subscribe to state changes.
   * @param {function(change)} fn - Called on any set, with {path, newValue, oldValue, prop, root}
   */
  proxy.subscribe = (fn) => listeners.add(fn);

  /**
   * Unsubscribe a listener.
   * @param {function(change)} fn
   */
  proxy.unsubscribe = (fn) => listeners.delete(fn);

  // --- Flexible DOM Binding API ---
  /**
   * Bind a state property to a DOM property or attribute (one-way or two-way).
   * 
   * @param {string|string[]} propertyPath - e.g. 'user.name' or ['user','name']
   * @param {string|Element} selectorOrElement - CSS selector or DOM element
   * @param {Object} options
   *   - {boolean} [twoWay=false]: If true, DOM updates state as well
   *   - {string} [eventType]: Which event to listen for (default: "input" for text, "change" for checkbox/select)
   *   - {string} [prop]: Property of element to bind (e.g. "value", "textContent", "innerHTML")
   *   - {string} [attr]: Attribute of element to bind (e.g. "data-user", "title")
   * @returns {Function} Call to unbind listeners
   */
  proxy.bindToDOM = function(propertyPath, selectorOrElement, options = {}) {
    const { twoWay = false, eventType, prop, attr } = options;
    // Accept dot, array, or string path
    const pathArr = Array.isArray(propertyPath)
      ? propertyPath
      : (typeof propertyPath === "string" ? propertyPath.split('.') : [propertyPath]);

    // Resolve DOM element
    let el =
      typeof selectorOrElement === "string"
        ? document.querySelector(selectorOrElement)
        : selectorOrElement;
    if (!el) {
      console.warn(`[createState] bindToDOM: Element not found for selector:`, selectorOrElement);
      return;
    }

    // Get/set nested property
    function getByPath(obj, path) {
      return path.reduce((o, key) => (o ? o[key] : undefined), obj);
    }
    function setByPath(obj, path, value) {
      let o = obj;
      for (let i = 0; i &lt; path.length - 1; i++) o = o[path[i]];
      o[path[path.length - 1]] = value;
    }

    // --- DOM update logic ---
    function updateDOM() {
      let value = getByPath(proxy, pathArr);
      if (prop) {
        // Bind to any property (e.g. textContent, innerHTML)
        el[prop] = value ?? "";
      } else if (attr) {
        // Bind to any attribute
        if (value == null) el.removeAttribute(attr);
        else el.setAttribute(attr, value);
      } else if (el.type === "checkbox") {
        el.checked = !!value;
      } else if (
        el.tagName === "INPUT" ||
        el.tagName === "TEXTAREA" ||
        el.tagName === "SELECT"
      ) {
        el.value = value ?? "";
      } else {
        el.textContent = value ?? "";
      }
    }

    updateDOM();

    // Only update if this specific property was changed
    const listener = (change) => {
      if (
        change.path.length === pathArr.length &amp;&amp;
        change.path.every((k, i) => k === pathArr[i])
      ) {
        updateDOM();
      }
    };
    proxy.subscribe(listener);

    // --- Two-way binding: DOM → state ---
    if (twoWay) {
      let readProp = prop;
      let evt =
        eventType ||
        (el.type === "checkbox"
          ? "change"
          : el.tagName === "SELECT"
          ? "change"
          : "input");
      const handler = (e) => {
        let val;
        if (attr) {
          val = el.getAttribute(attr);
        } else if (readProp) {
          val = el[readProp];
        } else if (el.type === "checkbox") {
          val = el.checked;
        } else {
          val = el.value;
        }
        setByPath(proxy, pathArr, val);
      };
      el.addEventListener(evt, handler);

      // Unbind both state and DOM listeners
      return () => {
        proxy.unsubscribe(listener);
        el.removeEventListener(evt, handler);
      };
    } else {
      return () => proxy.unsubscribe(listener);
    }
  };

  return proxy;
}

// Unwraps a state object or returns the value directly
export function unwrap(valOrState) {
  if (valOrState &amp;&amp; typeof valOrState === 'object' &amp;&amp; 'value' in valOrState) return valOrState.value;
  return valOrState;
}

/*
---------------------
----- EXAMPLES ------
---------------------

// 1. CREATE STATE
const state = createState({
  user: { name: "Alice", info: { city: "LA" } },
  checked: false,
  html: "&lt;b>Hi&lt;/b>"
});

// 2. GET/SET
state.user.name = "Bob";
state.user.info.city = "NY";
console.log(state.user.info.city);

// 3. SUBSCRIBE TO ALL CHANGES
state.subscribe(change => {
  console.log("Changed:", change.path.join("."), change.oldValue, "→", change.newValue);
});

// 4. DOM BINDING

// &lt;input id="nameInput">   &lt;span id="nameSpan">&lt;/span>
state.bindToDOM('user.name', '#nameInput', { twoWay: true });
state.bindToDOM('user.name', '#nameSpan', { prop: 'textContent' });

// &lt;div id="profileBox">&lt;/div>
state.bindToDOM(['user','name'], '#profileBox', { attr: 'data-username' });

// &lt;input type="checkbox" id="checkBox">
state.bindToDOM('checked', '#checkBox', { twoWay: true });

// &lt;div id="htmlBox">&lt;/div>
state.bindToDOM('html', '#htmlBox', { prop: 'innerHTML' });

// 5. UNBINDING
const unbind = state.bindToDOM('user.name', '#nameInput', { twoWay: true });
unbind();

*/</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
